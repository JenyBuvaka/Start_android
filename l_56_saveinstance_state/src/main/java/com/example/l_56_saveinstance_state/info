Когда работа Activity приостанавливается(onPause или onStop), она остается в памяти и хранит все свои объекты и их значения. И при возврате в Activity, все остается, как было. Но если приостановленное Activity уничтожается, например, при нехватке памяти, то соответственно удаляются и все его объекты. И если к нему снова вернуться, то системе надо заново его создавать и восстанавливать данные, которые были утеряны при уничтожении. Для этих целей Activity предоставляет нам для реализации пару методов: первый позволяет сохранить данные – onSaveInstanceState, а второй – восстановить - onRestoreInstanceState.

Эти методы используются в случаях, когда Activity уничтожается, но есть вероятность, что оно еще будет востребовано в своем текущем состоянии. Т.е. при нехватке памяти или при повороте экрана. Если же вы просто нажали кнопку Back (назад) и тем самым явно сами закрыли Activity, то эти методы не будут выполнены.

Но даже если не реализовать эти методы, у них есть реализация по умолчанию, которая сохранит и восстановит данные в экранных компонентах. Это выполняется для всех экранных компонентов, у которых есть ID.



Создадим простое приложение, чтобы протестить все эти тезисы. Посмотрим, в какой момент вызываются эти методы, попробуем в них что-нить сохранить. Также убедимся, что необходимо вызывать соответствующие методы супер-класса, чтобы сохранялись данные экранных компонентов.

В объект outState мы пишем значение переменной cnt. Механизм аналогичен помещению данных в Intent.Из savedInstanceState вытаскиваем значение и помещаем в переменную cnt. Теперь при уничтожении и воссоздании Activity переменная cnt сохранит свое значение, и наш счетчик продолжит работатьИтак, методы onSaveInstanceState и onRestoreInstanceState по дефолту сохраняют данные в экранных компонентах. Если мы реализуем их самостоятельно, то вызываем методы супер-класса и пишем свой код для своих переменных. Ради интереса, можете попробовать убрать вызовы методов суперкласса из onSaveInstanceState и onRestoreInstanceState. Данные в текстовом поле перестанут сохраняться при повороте экрана.

                                                                                                                                                                                                                                                                                               Кроме метода onRestoreInstanceState, доступ к сохраненным данным также можно получить в методе onCreate. На вход ему подается тот же самый Bundle. Если восстанавливать ничего не нужно, он будет = null.



                                                                                                                                                                                                                                                                                               Есть еще один полезный механизм сохранения данных. Android дает нам возможность сохранить ссылку на какой-либо объект и вернуть ее в новый созданный Activity. Для этого существуют методы:

                                                                                                                                                                                                                                                                                               onRetainNonConfigurationInstance – в нем мы сохраняем ссылку, передавая ее на выход (return) метода

                                                                                                                                                                                                                                                                                               getLastNonConfigurationInstance – этот метод ссылку нам возвращает



                                                                                                                                                                                                                                                                                               Т.е., например, у нас есть какой то объект myObj (класс MyObject) и нам надо сохранить ссылку на него при повороте экрана.

                                                                                                                                                                                                                                                                                               Мы реализуем в Activity метод onRetainNonConfigurationInstance:

                                                                                                                                                                                                                                                                                               1
                                                                                                                                                                                                                                                                                               2
                                                                                                                                                                                                                                                                                               3
                                                                                                                                                                                                                                                                                               public Object onRetainNonConfigurationInstance() {
                                                                                                                                                                                                                                                                                                 return myObj;
                                                                                                                                                                                                                                                                                               }
                                                                                                                                                                                                                                                                                               Этот метод будет вызван перед уничтожением Activity. От нас требуется дать на выход этому методу наш объект, который надо сохранить.



                                                                                                                                                                                                                                                                                               А, при создании нового Activity, в onCreate (например) мы используем метод getLastNonConfigurationInstance:

                                                                                                                                                                                                                                                                                               1
                                                                                                                                                                                                                                                                                               myObj = (MyObject) getLastNonConfigurationInstance();
                                                                                                                                                                                                                                                                                               Мы получили обратно объект класса Object и привели его к нашему классу MyObject.